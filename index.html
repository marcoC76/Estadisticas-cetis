<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estadísticas de Alumnos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    textarea {
      width: 100%;
      height: 200px;
      margin-bottom: 10px;
    }
    button, input {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin: 5px 0;
    }
    #resultados {
      margin-top: 20px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>Estadísticas de Alumnos</h1>

  <p>Pega tu JSON o carga un archivo CSV:</p>

  <!-- Entrada de JSON -->
  <textarea id="jsonInput" placeholder="Pega tu JSON aquí..."></textarea>
  <br>

  <!-- Subir archivo CSV -->
  <input type="file" id="fileInput" accept=".csv" onchange="procesarCSV(event)">
  <br>

  <!-- Botón para calcular -->
  <button onclick="calcularEstadisticas()">Calcular Estadísticas</button>

  <!-- Resultados -->
  <div id="resultados"></div>

  <script>
    let alumnos = []; // Variable global para almacenar los datos procesados

    // Procesar archivo CSV
    function procesarCSV(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const csvData = e.target.result;
        alumnos = csvToJson(csvData);
        alert("Archivo CSV procesado correctamente. ¡Ahora puedes calcular las estadísticas!");
      };
      reader.readAsText(file);
    }

    // Convertir CSV a JSON
    function csvToJson(csv) {
      const rows = csv.split("\n").filter(row => row.trim() !== ""); // Dividir por filas y eliminar vacías
      const headers = rows.shift().split(","); // Separar cabeceras

      return rows.map(row => {
        const values = row.split(",");
        return headers.reduce((obj, header, index) => {
          obj[header.trim()] = isNaN(values[index]) ? values[index].trim() : parseFloat(values[index]); // Convertir números
          return obj;
        }, {});
      });
    }

    // Calcular estadísticas
    function calcularEstadisticas() {
      const resultadosDiv = document.getElementById("resultados");
      resultadosDiv.innerHTML = ""; // Limpiar resultados previos

      try {
        // Verificar si se ingresaron datos por JSON
        const jsonInput = document.getElementById("jsonInput").value;
        if (jsonInput.trim()) {
          alumnos = JSON.parse(jsonInput);
        }

        if (alumnos.length === 0) {
          resultadosDiv.textContent = "No hay datos para procesar. Ingresa un JSON o carga un archivo CSV.";
          return;
        }

        // Variables para estadísticas
        const totalAlumnos = alumnos.length;
        const grupos = {};
        let aprobados = 0, reprobados = 0;

        // Procesar alumnos
        alumnos.forEach(alumno => {
          const grupo = alumno.GRUPO;

          // Inicializar grupo si no existe
          if (!grupos[grupo]) {
            grupos[grupo] = { total: 0, aprobados: 0, reprobados: 0 };
          }

          // Contar en grupo y general
          grupos[grupo].total++;
          if (alumno.Edo === "Aprobado") {
            grupos[grupo].aprobados++;
            aprobados++;
          } else {
            grupos[grupo].reprobados++;
            reprobados++;
          }
        });

        // Generar análisis de texto y resultados
        let resultados = `Total de alumnos: ${totalAlumnos}\n\n`;

        for (const [grupo, datos] of Object.entries(grupos)) {
          resultados += `Grupo ${grupo}:\n`;
          resultados += `  Total: ${datos.total}\n`;
          resultados += `  Aprobados: ${datos.aprobados} (${((datos.aprobados / datos.total) * 100).toFixed(2)}%)\n`;
          resultados += `  Reprobados: ${datos.reprobados} (${((datos.reprobados / datos.total) * 100).toFixed(2)}%)\n\n`;
        }

        resultados += `Estadísticas generales:\n`;
        resultados += `  Aprobados: ${aprobados} (${((aprobados / totalAlumnos) * 100).toFixed(2)}%)\n`;
        resultados += `  Reprobados: ${reprobados} (${((reprobados / totalAlumnos) * 100).toFixed(2)}%)\n`;

        // Mostrar resultados
        resultadosDiv.textContent = resultados;
      } catch (error) {
        resultadosDiv.textContent = "Error: Asegúrate de pegar un JSON válido o cargar un archivo CSV correcto.";
      }
    }
  </script>
</body>
</html>
